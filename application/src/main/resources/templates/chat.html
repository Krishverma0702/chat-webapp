<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Chat WebApp</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.1/stomp.min.js"></script>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card shadow-lg border-0 rounded-3">
            <div class="card-header bg-primary text-white text-center">
              <h4 class="mb-0">ðŸ’¬ Real-Time Chat</h4>
            </div>

            <div
              id="chat"
              class="card-body"
              style="height: 400px; overflow-y: auto; background-color: #f9f9f9"
            ></div>
            <div class="card-body border-top">
              <div class="mb-2">
                <input
                  id="senderInput"
                  type="text"
                  class="form-control"
                  placeholder="Enter your name..."
                />
              </div>

              <div class="input-group">
                <input
                  id="messageInput"
                  type="text"
                  class="form-control"
                  placeholder="Type your message..."
                />
                <button id="sendMessage" class="btn btn-success">Send</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      .chat-bubble {
        padding: 10px 15px;
        border-radius: 15px;
        margin-bottom: 8px;
        display: inline-block;
        max-width: 80%;
        word-wrap: break-word;
      }

      .chat-left {
        background: #e9ecef;
        align-self: flex-start;
      }

      .chat-right {
        background: #0d6efd;
        color: white;
        align-self: flex-end;
      }

      #chat {
        display: flex;
        flex-direction: column;
      }
    </style>
  </body>
  <script>
    function setConnected(connected) {
      document.getElementById("sendMessage").disabled = !connected;
    }

    function connect() {
      var socket = new SockJS("/chat");
      stompClient = Stomp.over(socket);

      stompClient.connect({}, function (frame) {
        setConnected(true);
        stompClient.subscribe("/topic/messages", function (message) {
          showMessage(JSON.parse(message.body));
        });
      });
    }

    function showMessage(message) {
   		const chat = document.getElementById("chat");
    	const messageElement = document.createElement("div");

   	 	const currentUser = (document.getElementById("senderInput").value || "").trim();
    	const sender = message.sender || "Unknown";
    	const content = message.content || message.contact || "(no message)";

    	messageElement.className = "chat-bubble " +
    	  (sender === currentUser ? "chat-right align-self-end" : "chat-left align-self-start");

    	messageElement.textContent = `${sender}: ${content}`;
    	chat.appendChild(messageElement);
    	chat.scrollTop = chat.scrollHeight;
    }


    function sendMessage() {
      var sender = document.getElementById("senderInput").value;
      var content = document.getElementById("messageInput").value;

      var chatMessage = {
        sender: sender,
        contact: content,
      };

      stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
      document.getElementById("messageInput").value = "";
    }

    document.getElementById("sendMessage").onclick = sendMessage;
    window.onload = connect;
  </script>
</html>